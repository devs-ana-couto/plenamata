!function(t){var e={$form:!1,$content:!1,$list:!1,$fields:!1,$status:!1,$footer:!1,$button:!1,main:function(){t(function(){e.init()})},init:function(){this.$content=t("#main-content"),this.$form=t("#commentform"),this.$form.length&&(this.$list=t("#comments-list"),this.$status=this.statusBox(),this.bindForm()),this.$content.length&&(this.$content.on("click","a.edit-comment-button",function(i){i.preventDefault();var s=t(this),n=s.parents(".comment-item").first();n.is(".editing")?e.doEdit(n,s):e.makeEditable(n,s)}),this.$content.on("click","a.remove-comment-button",function(i){i.preventDefault();var s=t(this),n=s.parents(".comment-item").first();e.doDelete(n,s)}))},bindForm:function(){this.$fields=t("input, textarea, selecet",this.$form),this.$form.attr("action",Piki.blogurl+"/envia-comentario/"),this.$form.on("submit",function(t){t.preventDefault(),e.submit()})},submit:function(){this.$fields.removeClass("error");var i=t.ajax({url:this.$form.attr("action"),type:"POST",dataType:"JSON",data:this.$form.serialize(),beforeSend:function(){t.fn.pikiLoader(),e.removeErrors()}});i.done(function(i){t.fn.pikiLoader("close"),"error"==i.status?e.setError(i):(e.insertComment(i.comment),e.setSuccess())}),i.fail(function(t,e){console.log("Request failed: "+e)})},doEdit:function(i,s){var n=t.ajax({url:s.attr("href"),type:"POST",dataType:"JSON",data:{comment_ID:s.attr("rel"),comment:i.find(".content-edit-field textarea").val(),editing:!0},beforeSend:function(){t.fn.pikiLoader(),PikiComm_remove_erro(i)}});n.done(function(s){t.fn.pikiLoader("close"),"error"==s.status?e.serError(i,s):e.editSuccess(i,s)}),n.fail(function(t,e){console.log("Request failed: "+e)})},doDelete:function(i,s){t.fn.pikiLoader();var n=t.ajax({url:s.attr("href"),type:"POST",dataType:"JSON",data:{comment_ID:s.attr("rel")}});n.done(function(s){t.fn.pikiLoader("close"),"error"==s.status?e.setError(i,s):i.slideUp(300,function(){t(this).remove()})}),n.fail(function(t,e){console.log("Request failed: "+e)})},insertComment:function(e){t(e).hide().prependTo(this.$list).slideDown("medium")},removeErrors:function(){this.$fields.removeClass("error"),this.$status.fadeOut()},setError:function(t){this.$fields.filter("#"+t.field).addClass("error"),this.setStatus("error",t.message)},setSuccess:function(){this.$form.reset();var t=this.$form.is(".comment-item")?"edited":"sibmited";this.setStatus("success","Your comment has been "+t+" successfully")},setStatus:function(t,e){this.$status.removeClass("error success alert").addClass(t).stop(!0,!0).hide().html(e).fadeIn("medium")},makeEditable:function(e,i){if(i.text("Salvar"),!e.is(".editing")){e.addClass("editing");var s=t(".comment-content",e),n=t(".content-edit-field",e);n.length||(n=t('<div class="content-edit-field"><textarea id="contnet-'+e.attr("id")+'">'+s.text()+"</textarea></div>").insertAfter(s).hide()),s.slideUp(300),n.slideDown(450)}},editSuccess:function(e,i){e.removeClass("editing"),window.PikiComm_remove_erro(e);t(".comment-content",e).html(i.comment).slideDown(450),t(".content-edit-field",e).slideUp(300),t(".pikilike-box",e).fadeIn(),t(".edit-comment-button",e).text("Editar")},statusBox:function(){return!1!==this.$status?this.$status:(this.$status=t('<div class="status"></div>').hide(),this.$button=t("#submit",this.$form),this.$footer=t(".comment-footer",this.$form),this.$footer.length?this.$status.appendTo($footer):this.$status.insertAfter(this.$button),this.$status)}};e.main()}(jQuery);