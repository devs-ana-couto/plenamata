!function($){$.fn.PikiImages=function(s,t,e){return this.each(function(){var a=$(this),o=a.data("PikiImages");if(void 0==s&&(s="configure"),"configure"!=s||void 0==o)switch(s){case"configure":o={wrapper:a,button:$("input#field_images_rebuild"),table:$("table.wp-list-table",a),list:$("table.wp-list-table tbody",a),posts:!1,status:$(".status",a),currentPost:!1},a.data("PikiImages",o),o.typeSelect=$("#piki_images_post_type",a),o.button.on("click",function(s){return s.preventDefault(),""===o.typeSelect.val()?void alert("Selecione um tipo de Post!"):void(o.button.is(".loading")||($.fn.pikiLoader(),o.button.addClass("loading").prop("disabled",!0).removeClass("button-primary"),a.PikiImages("setStatus","loading","Buscando posts com imagens"),a.PikiImages("retrivePosts",1)))});break;case"retrivePosts":$.ajax({type:"POST",dataType:"JSON",url:ajaxurl,data:{action:"piki_images_to_rebuild",post_type:o.typeSelect.val(),paged:t}}).done(function(s){return"error"==s.status?void alert("Aconteceu um erro inesperado. Consulte o administrador do sistema."):"no_fields"==s.status||"no_posts"==s.status?void a.PikiImages("setStatus","success",s.message):(a.PikiImages("insertPosts",s.posts),void(s.next_page?a.PikiImages("retrivePosts",s.next_page):(o.posts=o.list.children("tr"),a.PikiImages("setStatus","loading",'Analisando post <strong class="actual-key">1</strong> de <strong class="total-posts">'+o.posts.length+"</strong>"),$.fn.pikiLoader("close"),0==o.posts.length?a.PikiImages("setStatus","success","Nenhuma imagem a ser gerada."):a.PikiImages("proccessQueue"))))});break;case"insertPosts":o.table.show(),$.each(t,function(s){var t=$('<tr class="pending '+(s%2?"alternate":"")+'" post-id="'+this.ID+'"  post-type="'+this.post_type+'"></tr>').data("post",this).appendTo(o.list);t.append("<td>"+this.ID+"</td><td>"+this.post_title+'</td><td class="report"><span></span>Pendente</td>')});break;case"proccessQueue":$next=o.posts.filter(".pending").first(),$next.length?(o.currentPost=$next,a.PikiImages("proccessPost")):(alert("Todas as imagens foram geradas com sucesso."),o.button.removeClass("loading").prop("disabled",!1).addClass("button-primary"));break;case"proccessPost":o.currentPost.removeClass("pending").addClass("proccessing"),o.currentPost.children("td.report").html("<span></span>Processando Post");var i=o.status.find("strong.actual-key").first();i.html(parseInt(i.html())+1),$.ajax({type:"POST",dataType:"JSON",url:ajaxurl,data:{action:"piki_images_proccess_post",post_id:o.currentPost.attr("post-id"),post_type:o.currentPost.attr("post-type")}}).done(function(s){return"error"==s.status?void alert("Aconteceu um erro inesperado. Consulte o administrador do sistema."):(a.PikiImages("finalizePost",o.currentPost),void a.PikiImages("proccessQueue"))});break;case"finalizePost":var r=t;r.removeClass("proccessing").addClass("processed"),r.children("td.report").html("<span></span>Imagens processadas"),r.delay(1e3).slideUp(300,function(){$(this).remove()});break;case"setStatus":o.status.removeClass("error success normal").addClass(t).html(e).slideDown()}})},$(function(){$("#pikiforms_images_rebuild").PikiImages()})}(jQuery);