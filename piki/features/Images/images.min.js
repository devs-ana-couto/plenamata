!function(s){s.fn.PikiImages=function(t,e,a){return this.each(function(){var o=s(this),i=o.data("PikiImages");if(void 0==t&&(t="configure"),"configure"!=t||void 0==i)switch(t){case"configure":i={wrapper:o,button:s("input#field_images_rebuild"),table:s("table.wp-list-table",o),list:s("table.wp-list-table tbody",o),posts:!1,status:s(".status",o),currentPost:!1},o.data("PikiImages",i),i.typeSelect=s("#piki_images_post_type",o),i.button.on("click",function(t){t.preventDefault(),""!==i.typeSelect.val()?i.button.is(".loading")||(s.fn.pikiLoader(),i.button.addClass("loading").prop("disabled",!0).removeClass("button-primary"),o.PikiImages("setStatus","loading","Buscando posts com imagens"),o.PikiImages("retrivePosts",1)):alert("Selecione um tipo de Post!")});break;case"retrivePosts":s.ajax({type:"POST",dataType:"JSON",url:ajaxurl,data:{action:"piki_images_to_rebuild",post_type:i.typeSelect.val(),paged:e}}).done(function(t){console.info("response"),console.log(t),"error"!=t.status?"no_fields"!=t.status&&"no_posts"!=t.status?(o.PikiImages("insertPosts",t.posts),t.next_page?o.PikiImages("retrivePosts",t.next_page):(i.posts=i.list.children("tr"),o.PikiImages("setStatus","loading",'Analisando post <strong class="actual-key">1</strong> de <strong class="total-posts">'+i.posts.length+"</strong>"),s.fn.pikiLoader("close"),0==i.posts.length?o.PikiImages("setStatus","success","Nenhuma imagem a ser gerada."):o.PikiImages("proccessQueue"))):o.PikiImages("setStatus","success",t.message):alert("Aconteceu um erro inesperado. Consulte o administrador do sistema.")});break;case"insertPosts":i.table.show(),s.each(e,function(t){s('<tr class="pending '+(t%2?"alternate":"")+'" post-id="'+this.ID+'"  post-type="'+this.post_type+'"></tr>').data("post",this).appendTo(i.list).append("<td>"+this.ID+"</td><td>"+this.post_title+'</td><td class="report"><span></span>Pendente</td>')});break;case"proccessQueue":$next=i.posts.filter(".pending").first(),$next.length?(i.currentPost=$next,o.PikiImages("proccessPost")):(alert("Todas as imagens foram geradas com sucesso."),i.button.removeClass("loading").prop("disabled",!1).addClass("button-primary"));break;case"proccessPost":i.currentPost.removeClass("pending").addClass("proccessing"),i.currentPost.children("td.report").html("<span></span>Processando Post");var r=i.status.find("strong.actual-key").first();r.html(parseInt(r.html())+1),s.ajax({type:"POST",dataType:"JSON",url:ajaxurl,data:{action:"piki_images_proccess_post",post_id:i.currentPost.attr("post-id"),post_type:i.currentPost.attr("post-type")}}).done(function(s){"error"!=s.status?(o.PikiImages("finalizePost",i.currentPost),o.PikiImages("proccessQueue")):alert("Aconteceu um erro inesperado. Consulte o administrador do sistema.")});break;case"finalizePost":var n=e;n.removeClass("proccessing").addClass("processed"),n.children("td.report").html("<span></span>Imagens processadas"),n.delay(1e3).slideUp(300,function(){s(this).remove()});break;case"setStatus":i.status.removeClass("error success normal").addClass(e).html(a).slideDown()}})},s(function(){s("#pikiforms_images_rebuild").PikiImages()})}(jQuery);