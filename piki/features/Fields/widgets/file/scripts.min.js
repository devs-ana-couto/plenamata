PikiFields.add("window.startFile");var fileField;!function(e){window.startFile=function(){e('input[type="file"].ftype-file').each(function(){fileField.configure(this)})},fileField={configure:function(i){i.$=i.$||e(i);a=i.$.data("fileField");if(void 0===a){var a,t=i.$.parents("div.ftype-file.item-file").first();(a={_:i,$:i.$,wrapper:t,$form:i.$.parents("form").first(),$fake:e('<div class="jcuston-file-holder"></div>'),$selection:e(".selection-wrapper",t),$address:e("input.address",t),$file_id:e("input.file_id",t),maxsize:i.$.data("max-size"),maxsizeLabel:i.$.data("max-size-label"),title:i.$.attr("title"),isMultiple:t.hasClass("multiple"),$thumb:t.find(".thumbnail"),$mediaThumbs:t.find("div.media-thumbs"),$delete:t.find('button[data-action="delete"]')}).$fake.insertAfter(a.$),a.$.appendTo(a.$fake),void 0!==a.title&&(a.$title=e("<strong>"+a.title+"</strong>").appendTo(a.$fake)),a.$.data("fileField",a),a.wrapper.on("change",'input[type="file"]',function(){fileField.fieldChanged(a)}),a.$.bind("reset",function(){fileField.reset(a)}),a.$delete.length&&a.$delete.on("click",function(){Message.open({title:!1,message:"<h3>Tem certeza?</h3><p>Você tem certeza que deseja excluir esse arquivo?</p>",classname:"confirm",buttons_location:"inside",buttons:[{label:"Excluir",classname:"button cor2 delete-file-confirm",callback:function(){fileField.deleteFile(a)}},{label:"Cancelar",classname:"button delete-file-cancel"}]})})}},uniqueID:function(){return"_"+Math.random().toString(36).substr(2,9)},deleteFile:function(i){e.fn.pikiLoader("all");var a={action:"piki_field_ajax",field_type:"file",field_action:"ajax_delete_file",post_id:i.$form.find("input#item_id").val(),field_key:i.$.parents(".linha-field").first().data("machine-name"),nonce:i.$delete.data("token"),file_id:i.$delete.data("file-id")},t={type:"POST",url:Piki.ajaxurl,dataType:"json",data:a},l=e.ajax(t);l.done(function(a){e.fn.pikiLoader("close"),"error"==a.status?Message.open({message:"<em>"+a.error_message+"</em>",classname:"error"}):(i.$.val(""),fileField.reset(i))}),l.error(function(){e.fn.pikiLoader("close"),Message.open({message:"<em>Erro na requisição</em>",classname:"error"})})},varifyLimit:function(e){return e.maxItems<=e.$wrapImages.children(".row-file").not(".removed").length},fieldChanged:function(i){""!=i.$.val()&&(i.isMultiple?fileField.addNewRow(i):fileField.reset(i,function(){var a=new FileReader;a.onload=function(a){if(a.total>i.maxsize)Message.open("O arquivo deve ter no máximo "+i.maxsizeLabel);else{var t=i.$.val().split("\\").join("/").replace("\\","/").split("/").pop();i.$address.val(t),i.$file=e('<img src="'+a.target.result+'">'),i.$file.appendTo(i.previewbox),i.$.trigger("afterChange",i)}},a.readAsDataURL(i._.files[0])}))},reset:function(e,i){e.$address.val(""),e.$file_id.val(""),e.$mediaThumbs.remove(),e.$selection.slideDown(250),e.$.trigger("update",[e]),void 0!==i&&i(e)}},window.fileField_receive_file=function(i){e("#file-field-fake-form").remove();var a=e.parseJSON(i);if("error"==a.status)Message.open(a.message);else{var t=e('input[value="'+a.token+'"]').parents(".ftype-file.item-file").find('input[type="file"]').data("fileField");fileField.receiveImage(t,a)}},window.fileField_error=function(e,i){alert(i)}}(jQuery);