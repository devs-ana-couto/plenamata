PikiFields.add("FCidade.init");var FCidade;!function(e){(FCidade={main:function(){e(function(){FCidade.init()})},init:function(){var i=e("select.ftype-cidade");i.length&&i.each(function(){FCidade.configure(this)})},configure:function(i){i.$=i.$||e(i);var a=i.$.data("FCidade");void 0===a&&(a={_:i,$:i.$,initialValue:i.$.data("initial-value"),wrapper:i.$.parents(".field-item").first(),connectTo:i.$.data("state-connect"),grouper:!1,target:!1,preloader:!1},i.$.data("FCidade",a),void 0!==a.connectTo&&(a.grouper=a.$.parents(".fieldset-group-fields").first(),a.grouper.length||(a.grouper=a.$.parents("form").first()),a.targetLine=e(".linha-field.ftype-uf."+a.connectTo,a.grouper),a.target=e("select.ftype-uf",a.targetLine).first(),a.preloader=a.wrapper.children(".preloader"),"0"!=a.target.val()&&""!=a.target.val()&&FCidade.onStateChange(a,!0),a.target.on("change",function(){FCidade.onStateChange(a)})))},onStateChange:function(e,i){FCidade.clearCidades(e),FCidade.getCidades(e,i)},clearCidades:function(e){e.$.find("option").first();e.preloader.css("display","inline-table"),FCidade.clearField(e.$),FCidade.disableField(e.$),FCidade.disableField(e.target)},enableField:function(e){e.is(".piki-select")?PikiSelect.enable(e.data("PikiSelect")):e.prop("disabled",!1)},disableField:function(e){e.is(".piki-select")?PikiSelect.disable(e.data("PikiSelect")):e.prop("disabled","disabled")},clearField:function(e){e.is(".piki-select")?PikiSelect.removeItems(e.data("PikiSelect")):e.children("option").first().siblings().remove()},getCidades:function(i,a){if("0"==i.target.val()||""==i.target.val())return FCidade.clearCidades(i),FCidade.enableField(i.target),FCidade.disableField(i.$),void i.preloader.css("display","none");e.ajax({type:"POST",url:Piki.pluginsurl+"/piki/features/Fields/widgets/cidade/sources/"+i.target.val()+".json",dataType:"JSON",beforeSend:function(e){e.overrideMimeType("text/plain; charset=utf-8")}}).done(function(e){FCidade.pululateCidades(i,e),void 0!==a&&i.$.val(i.initialValue).trigger("change"),FCidade.enableField(i.target),i.preloader.css("display","none")})},pululateCidades:function(i,a){FCidade.clearField(i.$),e.each(a,function(e){i.$.append('<option value="'+this.id+'">'+this.nome+"</option>"),FCidade.enableField(i.$)})}}).main()}(jQuery);