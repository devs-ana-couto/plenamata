var fieldDate,_body;!function(a){DateField={main:function(){a(function(){DateField.init()})},init:function(){_body=a("body").first();var t=a(".linha-field.ftype-date.keep-history");t.length&&t.each(function(){this.$=this.$||a(this);var t=this.$.data("fieldDate");void 0===t&&((t={$:this.$,_:this,$add:a('button[data-action="add-value"]',this.$),modal:{$:a(".field-date-modal",this.$).appendTo(_body)}}).post_id=t.modal.$.attr("data-post-id"),t.field_name=t.modal.$.attr("data-field-name"),t.modal.$start=a("input",t.modal.$).first(),t.modal.$end=a("input",t.modal.$).last(),t.modal.$status=a("div.status",t.modal.$),t.modal.$cancel=a('button[data-action="cancel"]',t.modal.$),t.modal.$submit=a('button[data-action="submit"]',t.modal.$),t.$add.on("click",function(){DateField.modalOpen(t)}),t.modal.$submit.on("click",function(){DateField.validate(t)}),t.modal.$cancel.on("click",function(){DateField.modalClose(t)}))})},validate:function(a){var t=!1;DateField.modalClear(a),""==a.modal.$start.val()?(t="Informe a data inicial",a.modal.$start.addClass("error")):DateField.isValidDate(a.modal.$start.val())?""==a.modal.$end.val()?(t="Informe a data final",a.modal.$end.addClass("error")):DateField.isValidDate(a.modal.$end.val())||(t="Data final inválida",a.modal.$end.addClass("error")):(t="Data inicial inválida",a.modal.$start.addClass("error")),t?a.modal.$status.html(t).slideDown(350):(a.modal.$status.slideUp(200),DateField.submit(a))},submit:function(t){a.ajax({url:Piki.ajaxurl+"/?action=piki_field_ajax",type:"POST",dataType:"JSON",data:{field_type:"date",field_action:"ajax_new_value",field_name:t.field_name,post_id:t.post_id,data_start:t.modal.$start.val(),data_end:t.modal.$end.val()},beforeSend:function(t){a.fn.pikiLoader("all")}}).done(function(d){a.fn.pikiLoader("close"),"success"===d.status&&(DateField.modalClose(t),DateField.modalClear(t,!0))}).error(function(t,d){a.fn.pikiLoader("close"),Message.open({title:t.statusText,message:t.responseText})})},modalClear:function(a,t){a.modal.$start.removeClass("error"),a.modal.$end.removeClass("error"),!0===t&&(a.modal.$start.val(""),a.modal.$end.val(""))},modalClose:function(a){a.modal.$.fadeOut()},modalOpen:function(a){a.modal.$.css("display","flex").hide().fadeIn()},isValidDate:function(a){if(!/^\d{1,2}\/\d{1,2}\/\d{4}$/.test(a))return!1;var t=a.split("/"),d=parseInt(t[0],10),e=parseInt(t[1],10),l=parseInt(t[2],10);if(l<1e3||l>3e3||0==e||e>12)return!1;var i=[31,28,31,30,31,30,31,31,30,31,30,31];return(l%400==0||l%100!=0&&l%4==0)&&(i[1]=29),d>0&&d<=i[e-1]}},DateField.main()}(jQuery);