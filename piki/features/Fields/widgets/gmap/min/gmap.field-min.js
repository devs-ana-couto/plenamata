!function($){$(function(){var e=$("input.gmap-field");e.length&&e.gmapField();var o=$("div.gmap-map-box");o.length&&o.mapShow()}),window.gmap_load_api=function(){var e="https://maps.googleapis.com/maps/api/js?key=AIzaSyBlz40lqgiHqmHSkomJeVcZK1ywvmmDcY8&libraries=places&language=pt_BR&ver=3.20";$.getScript(e,function(e,o,t){return"success"==!o?(console.log("A API do google maps não foi carregada."),!1):!0})},$.fn.mapShow=function(){_this=this,this.$=$(this),this.timeOut=null,this.ID=this.$.attr("id"),this.icon=this.$.attr("data-icon"),this.latLng={lat:parseFloat(this.$.attr("data-latitude")),lng:parseFloat(this.$.attr("data-longitude"))},this.map=new google.maps.Map(document.getElementById(this.ID),{center:this.latLng,scrollwheel:!1,zoom:12}),this.marker=new google.maps.Marker({map:this.map,position:this.latLng,title:"Hello World!",icon:this.icon}),this.setCenter=function(){_this.map.setCenter(_this.latLng)},$(window).bind("resize",function(){clearTimeout(_this.timeOut),_this.timeOut=setTimeout(_this.setCenter(),1e3)})};var e={init:function(o){if(void 0===o.$mapa&&(o.$mapa=o.$.siblings(".gmap-map-area").first(),o.$mapa)){if(""!=o.$.val()){var t=o.$.val().split(",");o.initials.lat=t[0],o.initials.lng=t[1],o.zoom.init=o.zoom.max}var a=o.$mapa.siblings(".search-box");a.length?o.search={field:$("input.search-typing",a),button:$("input.button",a)}:o.search=!1,o.target=o.$mapa,o.target.data("gmapField",{target:o.$}),e.configure(o)}},configure:function(o){geocoder=new google.maps.Geocoder,o.initial_map&&(o.initials.lat=initial_map.lat,o.initials.lng=initial_map.lng,o.zoom.init=zoomMaxValue);var t=new google.maps.LatLng(o.initials.lat,o.initials.lng),a={disableDefaultUI:!0,center:t,zoom:o.zoom.init,minZoom:o.zoom.min,maxZoom:o.zoom.max,zoomControl:!0,zoomControlOptions:{style:google.maps.ZoomControlStyle.LARGE},disableDoubleClickZoom:!1,scrollwheel:o.scrollwhell,styles:[{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]}],mapTypeControl:!0,mapTypeId:google.maps.MapTypeId.ROADMAP};o.map=new google.maps.Map(document.getElementById(o.target.attr("id")),a),o.user_mark=new google.maps.Marker({map:o.map,draggable:!0,position:t,title:"Arraste para escolher o local exato"}),o.user_mark.target=o.$,google.maps.event.addListener(o.user_mark,"dragend",function(e){var t=o.user_mark.getPosition();o.$.val(t.lat()+","+t.lng()),o.map.panTo(t)}),google.maps.event.addListener(o.user_mark,"dragstart",function(e){var t=o.user_mark.target.data("gmapField");t.stopAutoSearch=!0}),o.search&&o.search.button.on("click",function(t){if(t.preventDefault(),""==o.search.field.val())alert("Para fazer a busca, digite um endereço.");else{var a=o.search.field.val();e.doSearch(o,a)}}),e.setConnections(o)},setConnections:function(o){if(o.connections){var t;t=o.$.parents(".fieldset-group-fields").length?o.$.parents(".fieldset-group-fields").first():o.$.parents("form").first();var a=["logradouro","number","bairro","cidade","estado","pais","cep"];$.each(a,function(a,i){var n=$("input.ftype-"+i+",select.ftype-"+i,t).first();n.length&&(o.connections.push(n),n.is("input")?n.on("blur",function(t){e.prepareSearch(o,$(this))}):n.is("select")&&n.on("change",function(t){e.prepareSearch(o,$(this))}))})}},getConnections:function(e){},prepareSearch:function(o,t){if(o.connections&&!(o.connections.length<1)&&1!=o.stopAutoSearch){var a=[];$.each(o.connections,function(e,o){var t=o.val();0!==t&&"0"!==t&&"_____-___"!=t&&""!=t&&(o.is("select")&&(t=o.children('option[value="'+t+'"]').text()),a.push(t))});var i=a.join(", ");e.doSearch(o,i)}},doSearch:function(o,t){$.fn.pikiLoader(),geocoder=new google.maps.Geocoder,geocoder.geocode({address:t},function(t,a){return $.fn.pikiLoader("close"),a!=google.maps.GeocoderStatus.OK?"ZERO_RESULTS"==a?(console.log("Endereço não encontrado"),"ZERO_RESULTS"):(console.log("erro"),!1):void e.actualizeDragger(o,t[0].geometry.location)})},actualizeDragger:function(e,o){e.$.val(o.lat()+","+o.lng()),e.map.panTo(o),e.user_mark.setPosition(o),e.map.setZoom(e.zoom.search)},renderBox:function(e){void 0==e&&(e={lat:e.$.attr("latitude"),lng:e.$.attr("longitude"),id:e.$.attr("id")},e.$.data("gmapRender",e)),e.geocoder=new google.maps.Geocoder,e.center=new google.maps.LatLng(e.lat,e.lng),e.mapOptions={disableDefaultUI:!0,center:e.center,zoom:15,minZoom:1,maxZoom:16,zoomControl:!0,zoomControlOptions:{style:google.maps.ZoomControlStyle.LARGE},disableDoubleClickZoom:!1,scrollwheel:!0,styles:[{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]}],mapTypeControl:!0,mapTypeId:google.maps.MapTypeId.ROADMAP},e.map=new google.maps.Map(document.getElementById(e.id),e.mapOptions),e.marker=new google.maps.Marker({map:e.map,draggable:!1,position:e.center}),e.marker.target=e.$}};$.fn.gmapField=function(o,t){return this.each(function(){void 0===this.$&&(this.$=$(this));var a=this.$.data("gmapField");if(void 0===a){var i={$:this.$,connections:[],map:!1,zoomSlider:!1,makers:[],infowindow:!1,stopAutoSearch:!1,zoom:{min:4,max:16,init:4,search:13},scrollwhell:!1,initials:{lat:-14.264383,lng:-51.943359},autocomplete:!1,geocoder:!1,lastSearchedString:!1,initial_map:!1,pikimapOpened:!1,cidadeBairros:!1},n=$.extend({},i,t);this.$.data("gmapField",n),a=this.$.data("gmapField")}if(e[o]){var r=Array.prototype.slice.call(arguments,1);return Array.prototype.unshift.call(r,a),e[o].apply(this,r)}return Array.prototype.unshift.call(arguments,a),e.init.apply(this,arguments)})},window.gfield_search_address=function(e){geocoder=new google.maps.Geocoder,geocoder.geocode({address:e},function(e,o){return o==google.maps.GeocoderStatus.OK?(console.log(e),e):"ZERO_RESULTS"==o?(console.log("not found"),"ZERO_RESULTS"):(console.log("erro"),!1)})}}(jQuery);