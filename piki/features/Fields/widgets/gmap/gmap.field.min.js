PikiFields.add("window.startGMapField"),function(e){window.startGMapField=function(){var t=e("input.gmap-field");t.length&&t.gmapField();var o=e("div.gmap-map-box");o.length&&o.mapShow()},window.gmap_load_api=function(){e.getScript("https://maps.googleapis.com/maps/api/js?key=AIzaSyBlz40lqgiHqmHSkomJeVcZK1ywvmmDcY8&libraries=places&language=pt_BR&ver=3.20",function(e,t,o){return"success"!=!t||(console.log("A API do google maps não foi carregada."),!1)})},e.fn.mapShow=function(){_this=this,this.$=e(this),this.timeOut=null,this.ID=this.$.attr("id"),this.icon=this.$.attr("data-icon"),this.latLng={lat:parseFloat(this.$.attr("data-latitude")),lng:parseFloat(this.$.attr("data-longitude"))},this.map=new google.maps.Map(document.getElementById(this.ID),{center:this.latLng,scrollwheel:!1,zoom:12}),this.marker=new google.maps.Marker({map:this.map,position:this.latLng,title:"Localização",icon:this.icon}),this.setCenter=function(){_this.map.setCenter(_this.latLng)},e(window).bind("resize",function(){clearTimeout(_this.timeOut),_this.timeOut=setTimeout(_this.setCenter(),1e3)})};var t={init:function(o){if(void 0===o.$mapa&&(o.$mapa=o.$.siblings(".gmap-map-area").first(),o.$mapa)){if(""!=o.$.val()){var a=o.$.val().split(","),i=void 0===o.$.data("initial-zoom")?o.zoom.max:o.$.data("initial-zoom");o.initials.lat=a[0],o.initials.lng=a[1],o.zoom.init=i}else o.zoom.init=o.initials.zoom;var n=o.$mapa.siblings(".search-box");n.length?o.search={field:e("input.search-typing",n),button:e("input.button",n)}:o.search=!1,o.target=o.$mapa,o.target.data("gmapField",{target:o.$}),t.configure(o)}},configure:function(e){geocoder=new google.maps.Geocoder,e.initial_map&&(e.initials.lat=initial_map.lat,e.initials.lng=initial_map.lng,e.zoom.init=initial_map.zoom);var o=new google.maps.LatLng(e.initials.lat,e.initials.lng),a={disableDefaultUI:!0,center:o,zoom:e.zoom.init,minZoom:e.zoom.min,maxZoom:e.zoom.max,zoomControl:!0,zoomControlOptions:{style:google.maps.ZoomControlStyle.LARGE},disableDoubleClickZoom:!1,scrollwheel:e.scrollwhell,styles:[{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]}],mapTypeControl:!0,mapTypeId:google.maps.MapTypeId.ROADMAP};e.map=new google.maps.Map(document.getElementById(e.target.attr("id")),a);var i={map:e.map,draggable:!0,position:o,title:"Arraste para escolher o local exato"},n=e.$.data("marker");void 0!==n&&(i.icon=n),e.user_mark=new google.maps.Marker(i),e.user_mark.target=e.$,google.maps.event.addListener(e.user_mark,"dragend",function(t){var o=e.user_mark.getPosition();e.$.val(o.lat()+","+o.lng()),e.map.panTo(o),e.$.trigger("dragend",e)}),google.maps.event.addListener(e.user_mark,"dragstart",function(t){e.user_mark.target.data("gmapField");e.$.trigger("dragstart",e)}),e.search&&e.search.button.on("click",function(o){if(o.preventDefault(),""==e.search.field.val())alert("Para fazer a busca, digite um endereço.");else{var a=e.search.field.val();t.doSearch(e,a)}}),t.setConnections(e)},setConnections:function(o){if(o.connections){var a;a=o.$.parents(".fieldset-group-fields").length?o.$.parents(".fieldset-group-fields").first():o.$.parents("form").first();e.each(["cep"],function(i,n){var r=e("input.ftype-"+n+",select.ftype-"+n,a).first();r.length&&(o.connections.push(r),r.is("input")?r.on("blur",function(){t.prepareSearch(o,e(this))}):r.is("select")&&r.on("change",function(){t.prepareSearch(o,e(this))}))})}},prepareSearch:function(o,a){if(o.connections&&!(o.connections.length<1)&&1!=o.stopAutoSearch){var i=[];e.each(o.connections,function(e,t){var o=t.val();0!==o&&"0"!==o&&"_____-___"!=o&&""!=o&&(t.is("select")&&(o=t.children('option[value="'+o+'"]').text()),i.push(o))});var n=i.join(", ");t.doSearch(o,n)}},doSearch:function(e,o){o.length<9||(geocoder=new google.maps.Geocoder,geocoder.geocode({address:o},function(o,a){if(a!=google.maps.GeocoderStatus.OK)return"ZERO_RESULTS"==a?(console.log("Endereço não encontrado"),"ZERO_RESULTS"):(console.log("erro"),!1);t.actualizeDragger(e,o[0].geometry.location)}))},actualizeDragger:function(e,t){e.$.val(t.lat()+","+t.lng()),e.map.panTo(t),e.user_mark.setPosition(t),e.map.setZoom(e.zoom.search)},renderBox:function(e){void 0==e&&(e={lat:e.$.attr("latitude"),lng:e.$.attr("longitude"),id:e.$.attr("id")}).$.data("gmapRender",e),e.geocoder=new google.maps.Geocoder,e.center=new google.maps.LatLng(e.lat,e.lng),e.mapOptions={disableDefaultUI:!0,center:e.center,zoom:15,minZoom:1,maxZoom:22,zoomControl:!0,zoomControlOptions:{style:google.maps.ZoomControlStyle.LARGE},disableDoubleClickZoom:!1,scrollwheel:!0,styles:[{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]}],mapTypeControl:!0,mapTypeId:google.maps.MapTypeId.ROADMAP},e.map=new google.maps.Map(document.getElementById(e.id),e.mapOptions),e.marker=new google.maps.Marker({map:e.map,draggable:!1,position:e.center}),e.marker.target=e.$}};e.fn.gmapField=function(o,a){return this.each(function(){void 0===this.$&&(this.$=e(this));var i=this.$.data("gmapField");if(void 0===i){var n={$:this.$,connections:[],map:!1,zoomSlider:!1,makers:[],infowindow:!1,stopAutoSearch:!1,zoom:{min:4,max:22,init:this.$.data("initial-zoom"),search:18},scrollwhell:!1,initials:{lat:-15.7939,lng:-47.882764,zoom:5},autocomplete:!1,geocoder:!1,lastSearchedString:!1,initial_map:!1,pikimapOpened:!1,cidadeBairros:!1},r=e.extend({},n,a);this.$.data("gmapField",r),i=this.$.data("gmapField")}if(t[o]){var l=Array.prototype.slice.call(arguments,1);return Array.prototype.unshift.call(l,i),t[o].apply(this,l)}return Array.prototype.unshift.call(arguments,i),t.init.apply(this,arguments)})},window.gfield_search_address=function(e){geocoder=new google.maps.Geocoder,geocoder.geocode({address:e},function(e,t){return t==google.maps.GeocoderStatus.OK?(console.log(e),e):"ZERO_RESULTS"==t?(console.log("not found"),"ZERO_RESULTS"):(console.log("erro"),!1)})}}(jQuery);