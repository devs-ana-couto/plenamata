!function($){jQuery.fn.farbtastic=function(t){return $.farbtastic(this,t),this},jQuery.farbtastic=function(t,e){return(t=$(t).get(0)).farbtastic||(t.farbtastic=new jQuery._farbtastic(t,e))},jQuery._farbtastic=function(t,e){var o=this;$(t).html('<div class="farbtastic"><div class="color"></div><div class="wheel"></div><div class="overlay"></div><div class="h-marker marker"></div><div class="sl-marker marker"></div></div>');var a=$(".farbtastic",t);o.wheel=$(".wheel",t).get(0),o.radius=84,o.square=100,o.width=194,navigator.appVersion.match(/MSIE [0-6]\./)&&$("*",a).each(function(){if("none"!=this.currentStyle.backgroundImage){var t=this.currentStyle.backgroundImage;t=this.currentStyle.backgroundImage.substring(5,t.length-2),$(this).css({backgroundImage:"none",filter:"progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled=true, sizingMethod=crop, src='"+t+"')"})}}),o.linkTo=function(t){return"object"==typeof o.callback&&$(o.callback).unbind("keyup",o.updateValue),o.color=null,"function"==typeof t?o.callback=t:"object"!=typeof t&&"string"!=typeof t||(o.callback=$(t),o.callback.bind("keyup",o.updateValue),o.callback.get(0).value&&o.setColor(o.callback.get(0).value)),this},o.updateValue=function(t){this.value&&this.value!=o.color&&o.setColor(this.value)},o.setColor=function(t){var e=o.unpack(t);return o.color!=t&&e&&(o.color=t,o.rgb=e,o.hsl=o.RGBToHSL(o.rgb),o.updateDisplay()),this},o.setHSL=function(t){return o.hsl=t,o.rgb=o.HSLToRGB(t),o.color=o.pack(o.rgb),o.updateDisplay(),this},o.widgetCoords=function(t){var e,a,r=t.target||t.srcElement,s=o.wheel;if(void 0!==t.offsetX){for(var i={x:t.offsetX,y:t.offsetY},n=r;n;)n.mouseX=i.x,n.mouseY=i.y,i.x+=n.offsetLeft,i.y+=n.offsetTop,n=n.offsetParent;for(var n=s,u={x:0,y:0};n;){if(void 0!==n.mouseX){e=n.mouseX-u.x,a=n.mouseY-u.y;break}u.x+=n.offsetLeft,u.y+=n.offsetTop,n=n.offsetParent}for(n=r;n;)n.mouseX=void 0,n.mouseY=void 0,n=n.offsetParent}else{i=o.absolutePosition(s);e=(t.pageX||0*(t.clientX+$("html").get(0).scrollLeft))-i.x,a=(t.pageY||0*(t.clientY+$("html").get(0).scrollTop))-i.y}return{x:e-o.width/2,y:a-o.width/2}},o.mousedown=function(t){document.dragging||($(document).bind("mousemove",o.mousemove).bind("mouseup",o.mouseup),document.dragging=!0);var e=o.widgetCoords(t);return o.circleDrag=2*Math.max(Math.abs(e.x),Math.abs(e.y))>o.square,o.mousemove(t),!1},o.mousemove=function(t){var e=o.widgetCoords(t);if(o.circleDrag){var a=Math.atan2(e.x,-e.y)/6.28;a<0&&(a+=1),o.setHSL([a,o.hsl[1],o.hsl[2]])}else{var r=Math.max(0,Math.min(1,-e.x/o.square+.5)),s=Math.max(0,Math.min(1,-e.y/o.square+.5));o.setHSL([o.hsl[0],r,s])}return!1},o.mouseup=function(){$(document).unbind("mousemove",o.mousemove),$(document).unbind("mouseup",o.mouseup),document.dragging=!1},o.updateDisplay=function(){var t=6.28*o.hsl[0];$(".h-marker",a).css({left:Math.round(Math.sin(t)*o.radius+o.width/2)+"px",top:Math.round(-Math.cos(t)*o.radius+o.width/2)+"px"}),$(".sl-marker",a).css({left:Math.round(o.square*(.5-o.hsl[1])+o.width/2)+"px",top:Math.round(o.square*(.5-o.hsl[2])+o.width/2)+"px"}),$(".color",a).css("backgroundColor",o.pack(o.HSLToRGB([o.hsl[0],1,.5]))),"object"==typeof o.callback?($(o.callback).css({backgroundColor:o.color,color:o.hsl[2]>.5?"#000":"#fff"}),$(o.callback).each(function(){this.value&&this.value!=o.color&&(this.value=o.color)})):"function"==typeof o.callback&&o.callback.call(o,o.color)},o.absolutePosition=function(t){var e={x:t.offsetLeft,y:t.offsetTop};if(t.offsetParent){var a=o.absolutePosition(t.offsetParent);e.x+=a.x,e.y+=a.y}return e},o.pack=function(t){var e=Math.round(255*t[0]),o=Math.round(255*t[1]),a=Math.round(255*t[2]);return"#"+(e<16?"0":"")+e.toString(16)+(o<16?"0":"")+o.toString(16)+(a<16?"0":"")+a.toString(16)},o.unpack=function(t){return 7==t.length?[parseInt("0x"+t.substring(1,3))/255,parseInt("0x"+t.substring(3,5))/255,parseInt("0x"+t.substring(5,7))/255]:4==t.length?[parseInt("0x"+t.substring(1,2))/15,parseInt("0x"+t.substring(2,3))/15,parseInt("0x"+t.substring(3,4))/15]:void 0},o.HSLToRGB=function(t){var e,o,a=t[0],r=t[1],s=t[2];return o=s<=.5?s*(r+1):s+r-s*r,e=2*s-o,[this.hueToRGB(e,o,a+.33333),this.hueToRGB(e,o,a),this.hueToRGB(e,o,a-.33333)]},o.hueToRGB=function(t,e,o){return 6*(o=o<0?o+1:o>1?o-1:o)<1?t+(e-t)*o*6:2*o<1?e:3*o<2?t+(e-t)*(.66666-o)*6:t},o.RGBToHSL=function(t){var e,o,a,r,s,i,n=t[0],u=t[1],c=t[2];return e=Math.min(n,Math.min(u,c)),o=Math.max(n,Math.max(u,c)),a=o-e,i=(e+o)/2,s=0,i>0&&i<1&&(s=a/(i<.5?2*i:2-2*i)),r=0,a>0&&(o==n&&o!=u&&(r+=(u-c)/a),o==u&&o!=c&&(r+=2+(c-n)/a),o==c&&o!=n&&(r+=4+(n-u)/a),r/=6),[r,s,i]},$("*",a).mousedown(o.mousedown),o.setColor("#000000"),e&&o.linkTo(e)},$.fn.datepickerField=function(method){var pluginArgs=arguments;return this.each(function(){var field=this,$this=$(this);this.configure=function(){this.widget=$('<div class="ftype-colorpicker-widget"></div>').insertAfter($this),this.picker=$.farbtastic(this.widget),""==$this.val()&&(this.picker.setColor("#ffffff"),$this.val("#ffffff")),this.picker.linkTo($this),this.ready=!0};var toCall;if(void 0==(toCall=eval("this."+method))){if(1==this.ready)return;this.configure.apply(this,pluginArgs)}else toCall.apply(this,Array.prototype.slice.call(pluginArgs,1))})},$(function(){$("input.ftype-colorpicker").datepickerField()})}(jQuery);